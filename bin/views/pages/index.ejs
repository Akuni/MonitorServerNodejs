<!-- views/pages/index.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <% include ../partials/head %>
</head>
<body class="container">

<script src="http://code.highcharts.com/highcharts.js"></script>
<script type="text/javascript">
    var makeChart = function(tempArray) {

    var d = [];
    var l = [];
    for(var i = 0; i < tempArray.length; i++){
        d[i] = tempArray[i].value.substring(6,10);

        l[i] = new Date(tempArray[i].timestamp).toLocaleString();
    }

    Highcharts.chart('container', {
    title: {
        text: 'Temperature every 5 minutes',
        x: -20 //center
    },
    subtitle: {
        text: 'Source: Raspberry Pi',
        x: -20
    },
    xAxis: {
        categories: l
    },
    yAxis: {
        title: {
            text: 'Temperature (°C)'
        },
        plotLines: [{
            value: 0,
            width: 1,
            color: '#808080'
        }]
    },
    tooltip: {
        valueSuffix: '°C'
    },
    legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'middle',
        borderWidth: 0
    },
    series: [{
        name: 'Temperature',
        data: d
    }]
});
}
    
</script>

    <header>
        <% include ../partials/header %>
    </header>

    <main>
        <div class="jumbotron">
            <h1>This is great</h1>
            <p>Welcome to templating using EJS</p>
        </div>
        <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto">
        <script> var t = [<%=temp%>]; markeChart(t); </script>
        <table class="custom_table">
            <tr>
                <td>
                    Date
                </td>
                <td>
                    Temp
                </td>
            </tr>
            <% temp.forEach(function(t) { %>
                <tr>
                    <td>
                        <%= new Date(t.timestamp).toLocaleString() %>
                    </td>
                    <td> 
                        <%= t.value %>
                    </td>
                </tr>
            <% }); %>
        </table>
    </main>

    <footer>
        <% include ../partials/footer %>
    </footer>
    
</body>
</html>